- Before upgrading to a new version, **always check [Following HEAD](Following-HEAD).**

---

- [Quick start](#quick-start)
- [Running tests](#running-tests)
- [Optimized builds](#optimized-builds)
- [Debug builds](#debug-builds)
- [Localization](#localization)
- [Compiler options](#compiler-options)
- [Xcode and MSVC project files](#xcode-and-msvc-project-files)
- [Custom Makefile](#custom-makefile)
- [Third-party dependencies](#third-party-dependencies)
- [About CMake](#about-cmake)
- [Build prerequisites](#build-prerequisites)

## Quick start

1. Verify that you have the [build prerequisites](#build-prerequisites) installed.
2. Clone [`neovim/neovim`](https://github.com/neovim/neovim).
    - If you want the **stable release**: `git checkout v0.2.2` (or the most-recent tag)
3. Build Neovim by running `make`. (On BSD systems use `gmake` / GNU Make.)
    - Set `CMAKE_INSTALL_PREFIX` if you want to **install to a custom location**. See [Installing Neovim](https://github.com/neovim/neovim/wiki/Installing-Neovim#install-from-source).

Other notes:

- Third-party dependencies (libuv, LuaJIT, etc.) are downloaded automatically to `.deps/`. See [FAQ](FAQ#build-issues) if you have issues.
- To generate the `Makefile` without building: `make cmake`
- If you plan to develop Neovim, install [ninja](https://ninja-build.org/) for faster builds. It will be used automatically.

Now that you have the dependencies, you can try other build targets, explained below.

## Running tests

See [test/README.md](https://github.com/neovim/neovim/blob/master/test/README.md)

## Optimized builds

```
rm -r build
make clean
make CMAKE_BUILD_TYPE=Release
```

For developers and "edge" users, `RelWithDebInfo` is recommended over `Release` as the latter doesn't generate debug info.

To verify the build type after compilation, run `./build/bin/nvim --version | grep ^Build`

## Debug builds

nvim links statically some libraries, in order to be able to step into some of these functions, you might want to compile them with debug informations as well.

```
make distclean
VERBOSE=1 DEBUG=1 make deps
```

## Localization

#### Localization build

A normal build will create `.mo` files in `build/src/nvim/po`.

* If you see `msgfmt: command not found`, you need to install [`gettext`](http://en.wikipedia.org/wiki/Gettext). On most systems the package is just called `gettext`.

#### Localization check

To check the translations for `$LANG`, run `make -C build check-po-$LANG`. Examples:

    make -C build check-po-de
    make -C build check-po-pt_BR

- Use `ninja` instead of `make` if applicable.
- `check-po-$LANG` generates a detailed report in `./build/src/nvim/po/check-${LANG}.log`. 
  (The report is generated by `nvim`, not by `msgfmt`.)

#### Localization update

To update the `src/nvim/po/$LANG.po` file with the latest strings, run the following:

    make -C build update-po-$LANG

- Replace `make` with `ninja` if applicable.
- **Note:** run `src/nvim/po/cleanup.vim` after updating.

## Compiler options

To see the chain of includes, use the `-H` option ([#918](https://github.com/neovim/neovim/issues/918)):

```
echo '#include "./src/nvim/buffer.h"' | \
> clang -I.deps/usr/include -Isrc -std=c99 -P -E -H - 2>&1 >/dev/null | \
> grep -v /usr/
```

- `grep -v /usr/` is used to filter out system header files
- `-save-temps` can be added as well to see expanded macros or commented assembly

## Xcode and MSVC project files

CMake has a `-G` option for exporting to multiple [project file formats](http://www.cmake.org/cmake/help/v2.8.8/cmake.html#section_Generators), such as Xcode and Visual Studio. 

For example, to use Xcode's static analysis GUI ([#167](https://github.com/neovim/neovim/issues/167#issuecomment-36136018)), you need to generate an Xcode project file from the Neovim makefile (where `neovim/` is the top-level Neovim source code directory containing the main `Makefile`):

    cmake -G Xcode neovim

then open the resulting project file in Xcode.

## Custom Makefile

You can customize the build process locally by creating a `local.mk`, which is referenced at the top of the main `Makefile`. It's listed in `.gitignore` so it can be used across branches. **A new target in `local.mk` overrides the default make-target.**

Here's a sample `local.mk` which adds a target to force a rebuild but *does not* override the default-target:

```make
all:

rebuild:
	rm -rf build
	make
```

## Third-party dependencies

See [#1588](https://github.com/neovim/neovim/pull/1588).

To build the bundled dependencies using CMake:

```sh
mkdir .deps ; cd .deps
cmake ../third-party
make
```

By default the libraries and headers are placed in `.deps/usr`. Now you can build Neovim:

```sh
mkdir build ; cd build
cmake ..
make
```

### How to build without "bundled" dependencies

1. Install all dependencies manually.
2. Create directory `build` in the root of the repository.
3. Switch to it and run `cmake ..` with all necessary options and environment. E.g.:
   ```
   CC=clang CFLAGS=" -O0 -g " cmake .. -DMIN_LOG_LEVEL=3 -DCMAKE_INSTALL_PREFIX=foo
   ```
4. Run `make`.


## About CMake

- [cmake.org](https://cmake.org)
- `cmake -LAH` prints all variable definitions.
- `build/CMakeCache.txt` contains the resolved values of all variables used by CMake.
- `build/compile_commands.json` shows the full compiler invocations for each translation unit.

## Build prerequisites

General requirements (see [#1469](https://github.com/neovim/neovim/issues/1469#issuecomment-63058312)):
- A recent version of Clang, or GCC version `4.4` and above
- CMake version `2.8.7` and above, built with TLS/SSL support

Platform-specific requirements are listed below.

#### Ubuntu / Debian

    sudo apt-get install ninja-build libtool libtool-bin autoconf automake cmake g++ pkg-config unzip

Note: `libtool-bin` is only required for Ubuntu 16.04/Debian Jessie and newer.

#### CentOS / RHEL / Fedora

If you're using CentOS/RHEL 6 you need at least autoconf version 2.69 for
compiling the libuv dependency. See https://github.com/joyent/libuv/issues/1158.

    sudo yum -y install ninja-build libtool autoconf automake cmake gcc gcc-c++ make pkgconfig unzip

#### openSUSE

    sudo zypper install ninja libtool autoconf automake cmake gcc-c++ gettext-tools

#### Arch Linux

    sudo pacman -S base-devel cmake unzip ninja

#### Nix or NixOS

    $ cd path/to/neovim
    $ nix-shell '<nixpkgs>' -A neovim
    $ cmakeConfigurePhase
    build $ make

#### FreeBSD

    sudo pkg install cmake gmake libtool sha automake pkgconf unzip wget

If you get an error regarding a sha256sum mismatch, where
the actual sha256sum is `e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855`, then this is your issue (that's the sha256sum of an empty file). Also, make sure you have wget installed.
LuaRocks has bad interactions with cURL, at least under FreeBSD, and will die with
a PANIC in LuaJIT when trying to install a rock.

#### OpenBSD

```
doas pkg_add gmake cmake libtool unzip autoconf-2.69p2 automake-1.15p0
export AUTOCONF_VERSION=2.69
export AUTOMAKE_VERSION=1.15
```

For older versions of OpenBSD than 6.1, the `autoconf-2.69` and `automake-1.15` ports may have different `p` suffixes.

The build sometimes fails when using the top level Makefile, apparently due to some third-party component [#2445-comment](https://github.com/neovim/neovim/issues/2445#issuecomment-108124236). The following instructions use CMake

```
mkdir .deps
cd .deps
cmake ../third-party/
gmake
cd ..
mkdir build
cd build
cmake ..
gmake
```

#### macOS

* Install [Xcode](https://developer.apple.com/) and [Homebrew](http://brew.sh)
  or [MacPorts](http://www.macports.org)
* Install Xcode commandline tools `xcode-select --install`
* Install other dependencies:
  * via MacPorts:
    ```
    sudo port install ninja libtool autoconf automake cmake pkgconfig gettext
    ```
  * via Homebrew:
    ```
    brew install ninja libtool automake cmake pkg-config gettext
    ```
* If you see **wget certificate errors** (for macOS *before* version 10.10/Yosemite):
  * via MacPorts:
    ```
    sudo port install curl-ca-bundle
    echo CA_CERTIFICATE=/opt/local/share/curl/curl-ca-bundle.crt >> ~/.wgetrc
    ```
  * via Homebrew:
    ```
    brew install curl-ca-bundle
    echo CA_CERTIFICATE=$(brew --prefix curl-ca-bundle)/share/ca-bundle.crt >> ~/.wgetrc
    ```

#### cygwin

Install all dependencies the normal way, then build neovim the normal way for a random CMake application (i.e. do not use the `Makefile` that automatically downloads and builds "bundled" dependencies)

The cygport repo contains cygport files (like APKBUILD, PKGBUILD, etc.) for all the dependencies not available in the cygwin distribution, and describes any special commands or arguments needed to build. the cygport definitions also try to describe the required dependencies for each one.
unless custom commands are provided, cygport just calls autogen/cmake, make, make install, etc. in a clean, consistent way.

https://github.com/cascent/neovim-cygwin was built on cygwin 2.9.0. Newer libuv should require slightly less patching and some ssp stuff changed in cygwin 2.10.0 so that might change things too when building neovim.

#### Windows / MSVC

1. Install:
	- Visual Studio 2017 with the **Desktop development with C++** workload
	- CMake (required until [#8128](https://github.com/neovim/neovim/pull/8128))
	- Python 2 (required for libuv until [#8128](https://github.com/neovim/neovim/pull/8128))
	- gperf
1. Build the dependencies (works in Command Prompt or PowerShell):
	```batch
	mkdir .deps
	cd .deps
	cmake -G "Visual Studio 15 2017" -DCMAKE_BUILD_TYPE=RelWithDebInfo -DPYTHON_EXECUTABLE="C:\path\to\python.exe" ..\third-party\
	cmake --build .
	```
1. Open the neovim project in Visual Studio: _File → Open → ..._
1. [This step can be skipped if `gperf` is in the PATH.] In the Solution Explorer, right-click `CMakeSettings.txt` and select _Change CMake Settings_. This creates a new file `CMakeSettings.json`. Add this line:
	```
	"variables": [ {"name": "GPERF_PRG", "value": "C:\\path\\to\\gperf.exe"} ],
	```
	below this line:
	```
	"name": "x86-Release",
	```
1. Select **x86-Release** configuration from the project settings menu and wait for CMake configuration to complete.
1. Click _CMake → Build All_.
Note: It is also possible to build with the **x64-Release** configuration if `cmake -G "Visual Studio 15 2017 Win64"` is used to build the dependencies. However, the Debug configurations will not work because certain dependencies need to be linked with release version of the C runtime.

#### Windows / MSYS2

From the MSYS2 shell install these packages

```
pacman -S \
    mingw-w64-x86_64-{gcc,libtool,cmake,make,perl,python2,pkg-config,unibilium} \
    gperf
```

Now from the windows console (cmd.exe) setup the PATH and build

```cmd
set PATH=c:\msys64\mingw64\bin;%PATH%
set CC=gcc
```

Build using the `MinGW Makefiles` generator

```cmd
mkdir .deps
cd .deps
cmake  -G "MinGW Makefiles" ..\third-party\
mingw32-make
cd ..
mkdir build
cd build
cmake -G "MinGW Makefiles" -DGPERF_PRG="C:\msys64\usr\bin\gperf.exe" ..
mingw32-make
```

For 32bit builds adjust the package names and paths accordingly.
## Quickstart

If you just pulled the Neovim source and want to get a working `nvim` binary,

    make

pulls down third-party dependencies (such as libuv and luajit) into `.deps/`, and builds them. A number of [build prerequisites](#user-content-build-prerequisites) such as `libtool` are required for that, but the configure script will let you know if something is missing. Install the missing prerequisites, then try `make` again. If there are other problems, also have a look at the [build errors section](#troubleshootingfaq) further down.

* To generate the `Makefile`s without building: `make cmake`

Now that you have the dependencies, you can try other build targets and options, explained below.

## Legacy integration tests

To build and run all legacy (Vim) integration tests:

    make oldtest

## Integration tests

Until the Neovim lua client is ready, running integration tests requires some Python packages:

    make distclean
    make deps
    PKG_CONFIG_PATH="$(pwd)/.deps/usr/lib/pkgconfig" pip install lupa
    pip install neovim
    make test

A simple way to install Python and Python packages without requiring root is to use [pyenv](https://github.com/yyuu/pyenv). Using `pip --user` is another alternative.

## Unit tests

To build and run all unit tests:

    make unittest

To run a *specific* test file:

    TEST_FILE=test/unit/foo.lua make unittest

## Functional tests

`$GDB` can be set to [run tests under gdbserver](https://github.com/neovim/neovim/pull/1527). If `$VALGRIND` is also set, it will add the `--vgdb=yes` option to valgrind instead of
starting gdbserver. 

## "Release" build (optimized, NDEBUG)

    rm -rf build/ && make clean && make CMAKE_BUILD_TYPE=MinSizeRel

- `MinSizeRel` is CMake jargon for "minimum-sized release".
    - `Release` and `RelWithDebInfo` are also choices.

To verify that the build was optimized, you can set `VERBOSE=1` and look for the `-O` flag:

```
rm -rf build/ && make VERBOSE=1 CMAKE_BUILD_TYPE=MinSizeRel | grep -e '\-O'
/usr/bin/cc -DHAVE_CONFIG_H -DINCLUDE_GENERATED_DECLARATIONS -Os -DNDEBUG ... -Wall -Wextra -pedantic -Wno-unused-parameter -Wstrict-prototypes -std=gnu99 ...
```

Alternative to `CMAKE_BUILD_TYPE`:

    rm -rf build/ && make cmake CFLAGS='-Wno-error -DNDEBUG -O3 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1' && make

- `-U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1` is required because of [#223](https://github.com/neovim/neovim/issues/223).
- To see the full build output (including flags send to the compiler by make/CMake), change the `make` step to `VERBOSE=1 make`

## Localization build

A normal build will create all the `.mo` files and they reside in `build/src/nvim/po`.

* If you see `msgfmt: command not found`, you need to install [`gettext`](http://en.wikipedia.org/wiki/Gettext) (on Debian/Ubuntu: `sudo apt-get install gettext`).

## Localization check

- Change into the build directory and run `make check-po-$LANG` where `$LANG`
  is the language you want to check.  For instance, `make check-po-de` or `make
  check-po-pt_BR`.
- `check-po-$LANG` generates a detailed report in
  `./build/src/nvim/po/check-${LANG}.log`.  Note: this report is generated by
  Vim to help identify errors in the translations, not by `msgfmt`.

## Localization update

To update the `src/nvim/po/$LANG.po` file with the latest strings from sources, run
`make update-po-$LANG`.

## "GNU-like" (GCC, clang, ...) compiler options

To see the chain of includes, use the `-H` switch (see [#918](https://github.com/neovim/neovim/issues/918)):

```bash
$ echo '#include "./src/nvim/buffer.h"' |
clang -I.deps/usr/include -Isrc -std=c99 -P -E -H - 2>&1 1>/dev/null |
# ignore headers in /usr/*
grep -v '/usr/'
```

`-save-temps` useful to see expanded macros or commented assembly

## Xcode and MSVC project files

CMake has a `-G` option for exporting to many [project file formats](http://www.cmake.org/cmake/help/v2.8.8/cmake.html#section_Generators) such as Xcode and Visual Studio. 

For example, to use Xcode's static analysis GUI ([#167](https://github.com/neovim/neovim/issues/167#issuecomment-36136018)), you need to generate an Xcode project file from the Neovim makefile (where `neovim/` is the top-level Neovim source code directory containing the main `Makefile`):

```bash
cmake -G Xcode neovim/
```

then open the resulting project file in Xcode.

## Custom Makefile 
You can customize the build process locally on your machine by creating `local.mk` which is referenced at the top of the main `Makefile` (and listed in `.gitignore`). **A new target in `local.mk` overrides the default make-target.**

Here's a sample `local.mk` which adds a target to force a rebuild but *does not* override the default-target:
```make
all:

rebuild:
	rm -rf build && make
```

## Controlling the build for third-party dependencies

To build the bundled dependencies using CMake:

    mkdir .deps
    cd .deps
    cmake ../third-party/
    make
    cd ..

By default the libraries and headers are placed in `.deps/usr`, afterwards you can build Neovim using:

    mkdir build
    cd build
    cmake ..
    make

You can build the dependencies in a different location using:

    mkdir deps2
    cd deps2
    cmake ../third-party/
    make
    cd ..

And then build Neovim using:

    mkdir build
    cd build
    cmake -DDEPS_PREFIX=../deps2/usr ..

When changing `DEPS_PREFIX` you may need to clear the CMake cache in order for the changes to take effect.

## General notes on [CMake](http://www.cmake.org/examples/)

- `cmake -LAH` prints all variable definitions.
- `build/CMakeCache.txt` contains the resolved values of all variables used by CMake.
- `build/compile_commands.json` shows the full compiler invocations for each translation unit.

## Build Prerequisites

**General requirements:** 

- A fairly recent gcc (4.3) or clang (see [#1469](https://github.com/neovim/neovim/issues/1469#issuecomment-63058312))
- CMake built with SSL support (see [#1469](https://github.com/neovim/neovim/issues/1469#issuecomment-63058312))

Other dependencies are listed below.

<!-- the debianubuntu link below is to avoid breaking links that we used in issues and handed out to users. -->
<a name="for-debianubuntu"></a>
<a name="for-ubuntu"></a>
### Ubuntu

    sudo apt-get install libtool autoconf automake cmake libncurses5-dev g++ pkg-config unzip

<a name="for-debian"></a>
### Debian

    sudo apt-get install libtool libtool-bin autoconf automake cmake libncurses5-dev g++ pkg-config unzip

<a name="for-centos-rhel"></a>
### CentOS/RHEL/Fedora

If you're using CentOS/RHEL 6 you need at least autoconf version 2.69 for
compiling the libuv dependency. See https://github.com/joyent/libuv/issues/1158.

    sudo yum -y install autoconf automake cmake gcc gcc-c++ libtool ncurses-devel pkgconfig

<a name="for-opensuse"></a>
### openSUSE

    sudo zypper install libtool autoconf automake cmake ncurses-devel gcc-c++

<a name="for-freebsd-10"></a>
### FreeBSD 10

    sudo pkg install cmake libtool sha automake pkgconf unzip wget

Note: if you have cmake installed already, you may need to re-install it.  The
port had to be updated to support SSL for file downloads, so you may not have
that feature. If you see the download complaining about an md5sum mismatch, and
the actual md5sum is `d41d8cd98f00b204e9800998ecf8427e`, then this is your issue
(that's the md5sum of an empty file). Also, make sure you have wget installed.
Luarocks has bad interactions with curl, at least under FreeBSD, and will die with
a PANIC in LuaJIT when trying to install a rock.

<a name="for-arch-linux"></a>
### Arch Linux

    sudo pacman -S base-devel cmake ncurses pkg-config unzip

<a name="for-os-x"></a>
### OS X

* Install [Xcode](https://developer.apple.com/) and [Homebrew](http://brew.sh)
  or [MacPorts](http://www.macports.org)
* Install other dependencies:

  Via MacPorts:

      sudo port install libtool autoconf automake cmake pkgconfig gettext
      
  Via Homebrew:

      brew install libtool automake cmake pkg-config gettext

* **If you see wget certificate errors** (for OS X *before* version 10.10/Yosemite):

  Via MacPorts:

      sudo port install curl-ca-bundle
      echo CA_CERTIFICATE=/opt/local/share/curl/curl-ca-bundle.crt >> ~/.wgetrc

  Via Homebrew:

      brew install curl-ca-bundle
      echo CA_CERTIFICATE=$(brew --prefix curl-ca-bundle)/share/ca-bundle.crt >> ~/.wgetrc

## Troubleshooting/FAQ

If you run into an error not explained here and manage to resolve it, feel free to add it below!

### CMake errors

- `configure_file Problem configuring file`
    - This is probably a permissions issue, which can happen if you run `sudo make` and then later try an unprivileged `make`. To fix this, simply remove your `build/` directory and try again.

### Lua packages

A few lua packages are required for the build process. Normally these packages will be installed via [luarocks](http://luarocks.org/) (invoked by cmake automatically), but sometimes this will fail. There are two common causes for this:

- luarocks servers are down
- you need to install the 'unzip' command-line utility, if this is the case luarocks will report something like this: `Warning: Failed searching manifest: Failed loading manifest: Failed extracting manifest file`

To fix the first error, a luarocks mirror can be used:

```sh
cat >> .deps/usr/etc/luarocks/config-5.1.lua << "EOF"
rocks_servers={ 
  "http://luarocks.giga.puc-rio.br/" 
}
EOF
make cmake
```

Failing the above, you can always try installing the following packages manually:

- [lpeg](http://www.inf.puc-rio.br/~roberto/lpeg/)
- [lua-MessagePack](http://fperrad.github.io/lua-MessagePack/)

For running tests, these are also required:

- [busted](http://olivinelabs.com/busted/)

Keep in mind that some of those packages have their own dependencies which also have to be installed.
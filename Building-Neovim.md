## Quickstart

If you just pulled the Neovim source and want to get a working `nvim` binary,

    make

pulls down third-party dependencies (such as libuv and luajit) into `.deps/`, and builds them. If you're missing a dependency such as `libtool`, the configure script will let you know. Install the missing dependencies, then try `make` again. If there are other problems, also have a look at the [build errors section](#build-errors) further down.

* To generate the `Makefile`s without building: `make cmake`

Now that you have the dependencies, you can try other build targets and options, explained below.

## Legacy integration tests

To build and run all integration tests:

    make test

### Vroom tests

Neovim will now use [vroom](https://github.com/google/vroom/blob/master/examples/basics.vroom) to write tests/specifications. To install vroom a python installation is required:

```
pip install neovim
git clone git://github.com/google/vroom
cd vroom
python setup.py build
python setup.py install
```

A simple way to install python and it's packages without requiring root is to use [pyenv](https://github.com/yyuu/pyenv)

## Unit tests

To build and run all unit tests:

    make unittest

To run a *specific* test file:

   TEST_FILE=test/unit/foo.lua make unittest

## "Release" build (optimized, NDEBUG)

    rm -rf build/ && make clean && make CMAKE_BUILD_TYPE=MinSizeRel

- `MinSizeRel` is CMake jargon for "minimum-sized release".
    - `Release` and `RelWithDebInfo` are also choices.

To verify that the build was optimized, you can set `VERBOSE=1` and look for the `-O` flag:

```
rm -rf build/ && make VERBOSE=1 CMAKE_BUILD_TYPE=MinSizeRel | grep -e '\-O'
/usr/bin/cc -DHAVE_CONFIG_H -DINCLUDE_GENERATED_DECLARATIONS -Os -DNDEBUG ... -Wall -Wextra -pedantic -Wno-unused-parameter -Wstrict-prototypes -std=gnu99 ...
```

Alternative to `CMAKE_BUILD_TYPE`:

    rm -rf build/ && make cmake CFLAGS='-Wno-error -DNDEBUG -O3 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1' && make

- `-U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1` is required because of [#223](https://github.com/neovim/neovim/issues/223).
- To see the full build output (including flags send to the compiler by make/CMake), change the `make` step to `VERBOSE=1 make`

## Localization build

A normal build will create all the `.mo` files and they reside in `build/src/nvim/po`.

* If you see `msgfmt: command not found`, you need to install [`gettext`](http://en.wikipedia.org/wiki/Gettext) (on Debian/Ubuntu: `sudo apt-get install gettext`).

## Localization check

- Change into the build directory and run `make check-po-$LANG` where `$LANG`
  is the language you want to check.  For instance, `make check-po-de` or `make
  check-po-pt_BR`.
- `check-po-$LANG` generates a detailed report in
  `./build/src/nvim/po/check-${LANG}.log`.  Note: this report is generated by
  Vim to help identify errors in the translations, not by `msgfmt`.

## Localization update

To update the `src/nvim/po/$LANG.po` file with the latest strings from sources, run
`make update-po-$LANG`.

## "GNU-like" compiler (GCC, clang, ...) options

To see the chain of includes, use the `-H` switch (see [#918](https://github.com/neovim/neovim/issues/918)):

```bash
$ echo '#include "./src/nvim/buffer.h"' |
clang -I.deps/usr/include -Isrc -std=c99 -P -E -H - 2>&1 1>/dev/null |
# ignore headers in /usr/*
grep -v '/usr/'
```

`-save-temps` useful to see expanded macros or commented assembly

## Xcode and MSVC project files

CMake has a `-G` option for exporting to many [project file formats](http://www.cmake.org/cmake/help/v2.8.8/cmake.html#section_Generators) such as Xcode and Visual Studio. 

For example, to use Xcode's static analysis GUI ([#167](https://github.com/neovim/neovim/issues/167#issuecomment-36136018)), you need to generate an Xcode project file from the Neovim makefile (where `neovim/` is the top-level Neovim source code directory containing the main `Makefile`):

```bash
cmake -G Xcode neovim/
```

then open the resulting project file in Xcode.

## Custom Makefile 
You can customize the build process locally on your machine by creating `local.mk` which is referenced at the top of the main `Makefile` (and listed in `.gitignore`). **A new target in `local.mk` overrides the default make-target.**

Here's a sample `local.mk` which adds a target to force a rebuild but *does not* override the default-target:
```make
all:

rebuild:
	rm -rf build && make
```

## General notes on [CMake](http://www.cmake.org/examples/)

Print all variable definitions:

    cmake -LAH

<a name="build-errors"></a>
## Build errors

<a name="lua-packages"></a>
### Lua packages

A few lua packages are required for the build process. Normally these packages will be installed via [luarocks](http://luarocks.org/) (invoked by cmake automatically), but sometimes this will fail. There are two common causes for this:

- luarocks servers are down
- you need to install the 'unzip' command-line utility, if this is the case luarocks will report something like this: `Warning: Failed searching manifest: Failed loading manifest: Failed extracting manifest file`

To fix the first error, a luarocks mirror can be used:

```sh
cat >> .deps/usr/etc/luarocks/config-5.1.lua << "EOF"
rocks_servers={ 
  "http://luarocks.giga.puc-rio.br/" 
}
EOF
make cmake
```

Failing the above, you can always try installing the following packages manually:

- [lpeg](http://www.inf.puc-rio.br/~roberto/lpeg/)
- [lua-MessagePack](http://fperrad.github.io/lua-MessagePack/)

For running tests, these are also required:

- [busted](http://olivinelabs.com/busted/)

Keep in mind that some of those packages have their own dependencies which also have to be installed.